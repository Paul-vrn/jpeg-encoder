#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include <assert.h>
#include "bloc.h"

void test_fusion_2(){
	uint8_t matrice1[8][8] = {
		{117,117,117,117,118,118,119,120},
		{117,117,117,117,118,118,119,119},
		{117,117,118,118,118,118,119,119},
		{118,118,118,118,119,119,119,119},
		{118,118,119,119,119,119,120,120},
		{119,120,120,119,119,119,120,120},
		{119,119,119,120,120,120,120,120},
		{120,120,120,120,120,120,120,120}
	};

	uint8_t matrice2[8][8] = {
		{120,121,122,122,123,123,123,123},
		{120,121,121,122,122,122,123,123},
		{120,120,121,121,122,122,122,122},
		{120,120,121,121,122,122,122,122},
		{120,120,121,121,121,121,121,121},
		{120,120,120,120,121,121,121,121},
		{120,120,120,120,120,120,120,120},
		{120,120,120,120,120,120,120,120},
	};

	uint8_t matrice_result[8][8] = {
		{117,117,118,119,120,122,123,123},
		{117,117,118,119,120,121,122,123},
		{117,118,118,119,120,121,122,122},
		{118,118,119,119,120,121,122,122},
		{118,119,119,120,120,121,121,121},
		{119,119,119,120,120,120,121,121},
		{119,119,120,120,120,120,120,120},
		{120,120,120,120,120,120,120,120},
	};
	struct bloc_t *bloc1 = bloc_create(matrice1);
	struct bloc_t *bloc2 = bloc_create(matrice2);
	struct bloc_t *bloc_result = bloc_create(matrice_result);
	struct bloc_t *bloc_fusion = fusion_2_blocs(bloc1, bloc2);
	assert(compare_blocs(bloc_fusion, bloc_result));
	bloc_destroy(bloc1);
	bloc_destroy(bloc2);
	bloc_destroy(bloc_fusion);
	bloc_destroy(bloc_result);
	return;
}

void test_fusion(){
	uint8_t tab1[8][8] = {
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},   
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f}
	};  
	uint8_t tab2[8][8] = {
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},   
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f},    
		{0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f}
	};  
	uint8_t tab3[8][8] = 
	{{0x5c, 0x5c, 0x5c, 0x5c, 0x5c, 0x5c, 0x5c, 0x5c},
	{0x62, 0x62, 0x62, 0x62, 0x62, 0x62, 0x62, 0x62},
	{0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c},
	{0x75, 0x75, 0x75, 0x75, 0x75, 0x75, 0x75, 0x75},
	{0x7b, 0x7b, 0x7b, 0x7b, 0x7b, 0x7b, 0x7b, 0x7b},
	{0x7c, 0x7c, 0x7c, 0x7c, 0x7c, 0x7c, 0x7c, 0x7c},
	{0x7b, 0x7b, 0x7b, 0x7b, 0x7b, 0x7b, 0x7b, 0x7b},
	{0x79, 0x79, 0x79, 0x79, 0x79, 0x79, 0x79, 0x79}};

	uint8_t tab4[8][8] = 
	{{0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a},
	{0x61, 0x61, 0x61, 0x61, 0x61, 0x61, 0x61, 0x61},
	{0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c},
	{0x76, 0x76, 0x76, 0x76, 0x76, 0x76, 0x76, 0x76},
	{0x7c, 0x7c, 0x7c, 0x7c, 0x7c, 0x7c, 0x7c, 0x7c},
	{0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d},
	{0x7a, 0x7a, 0x7a, 0x7a, 0x7a, 0x7a, 0x7a, 0x7a},
	{0x78, 0x78, 0x78, 0x78, 0x78, 0x78, 0x78, 0x78}};


	uint8_t res[8][8] =
	{{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f},
	{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f},
	{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f},
	{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f},
	{0x5f,0x5f,0x5f,0x5f,0x5d,0x5d,0x5d,0x5d},
	{0x70,0x70,0x70,0x70,0x71,0x71,0x71,0x71},
	{0x7b,0x7b,0x7b,0x7b,0x7c,0x7c,0x7c,0x7c},
	{0x7a,0x7a,0x7a,0x7a,0x79,0x79,0x79,0x79}
	};

	struct bloc_t *bloc1 = bloc_create(tab1);
	bloc_add(&bloc1, bloc_create(tab2));
	bloc_add(&bloc1, bloc_create(tab3));
	bloc_add(&bloc1, bloc_create(tab4));
	struct bloc_t *bloc_result = bloc_create(res);
	blocs_print(bloc1);
	printf("------------------------------\n");
	blocs_fusion(&bloc1, 2, 2, 1, 2);
	blocs_print(bloc1);
}

void test_fusion_3_2(){
uint8_t tab1[8][8] = 
{{0x28,0x27,0x2a,0x2a,0x26,0x27,0x23,0x17},
{0x28,0x27,0x2a,0x2a,0x26,0x27,0x23,0x18},
{0x28,0x27,0x2a,0x2a,0x26,0x28,0x24,0x19},
{0x28,0x27,0x2a,0x2a,0x26,0x28,0x25,0x1a},
{0x28,0x27,0x2a,0x2a,0x26,0x2a,0x27,0x1c},
{0x28,0x27,0x2a,0x2a,0x26,0x2a,0x29,0x1e},
{0x28,0x27,0x2a,0x29,0x26,0x2a,0x2a,0x1f},
{0x28,0x27,0x2a,0x29,0x27,0x2a,0x2a,0x21}};
uint8_t tab2[8][8] = 
{{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16}};
uint8_t tab3[8][8] = 
{{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16},
{0x16,0x16,0x16,0x16,0x16,0x16,0x16,0x16}};
uint8_t tab4[8][8] = 
{{0x28,0x28,0x28,0x29,0x29,0x27,0x27,0x26},
{0x28,0x29,0x29,0x29,0x29,0x29,0x27,0x27},
{0x29,0x29,0x29,0x2a,0x2a,0x28,0x28,0x28},
{0x27,0x29,0x29,0x29,0x29,0x29,0x28,0x28},
{0x27,0x28,0x29,0x2a,0x2a,0x2a,0x29,0x29},
{0x27,0x29,0x29,0x29,0x29,0x29,0x27,0x27},
{0x27,0x29,0x29,0x29,0x28,0x27,0x26,0x26},
{0x27,0x29,0x29,0x28,0x27,0x27,0x26,0x26}};
uint8_t tab5[8][8] = 
{{0x15,0x1b,0x17,0x12,0x18,0x19,0x16,0x16},
{0x1b,0x17,0x12,0x14,0x18,0x15,0x14,0x17},
{0x19,0x16,0x1a,0x1d,0x17,0x12,0x14,0x16},
{0x1f,0x1a,0x19,0x16,0x11,0x17,0x1a,0x12},
{0x17,0x14,0x16,0x15,0x11,0x17,0x1a,0x13},
{0x25,0x19,0x12,0x14,0x16,0x16,0x14,0x11},
{0x22,0x12,0x7,0x11,0x2a,0x38,0x38,0x39},
{0x31,0x45,0x54,0x5f,0x6d,0x74,0x77,0x7c}};

uint8_t tab6[8][8] = 
{{0x17,0x16,0x15,0x16,0x17,0x17,0x16,0x15},
{0x16,0x16,0x15,0x15,0x16,0x16,0x16,0x15},
{0x14,0x15,0x15,0x15,0x16,0x17,0x17,0x17},
{0x17,0x17,0x18,0x17,0x15,0x14,0x14,0x15},
{0x13,0x14,0x15,0x15,0x13,0x13,0x14,0x15},
{0x15,0x19,0x1f,0x23,0x27,0x2b,0x31,0x35},
{0x52,0x57,0x5f,0x64,0x67,0x6d,0x73,0x78},
{0x7e,0x80,0x84,0x83,0x80,0x80,0x82,0x86}};

	struct bloc_t *bloc1 = bloc_create(tab1);
	bloc_add(&bloc1, bloc_create(tab2));
	bloc_add(&bloc1, bloc_create(tab3));
	bloc_add(&bloc1, bloc_create(tab4));
	bloc_add(&bloc1, bloc_create(tab5));
	bloc_add(&bloc1, bloc_create(tab6));
	blocs_print(bloc1);
	printf("------------------------------\n");
	blocs_fusion(&bloc1, 3, 2, 1, 2);
	blocs_print(bloc1);


}
int main(void)
{
	//test_fusion_2();
	//test_dct();
	test_fusion_3_2();
	return EXIT_SUCCESS;
}